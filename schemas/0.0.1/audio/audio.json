{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Audio File Schema",
  "type": "object",
  "properties": {
    "schema_version": {
      "type": "integer",
      "enum": [1]
    },
    "id": {
      "type": "string",
      "pattern": "^[a-fA-F0-9]{24}$",
      "minLength": 24,
      "maxLength": 24,
      "description": "MongoDB ObjectId"
    },
    "url": {
      "type": "string",
      "description": "S3 URL: https://s3.../prod/audio/{hash}.mp3"
    },
    "s3_key": {
      "type": "string",
      "description": "S3 object key: prod/audio/{hash}.mp3"
    },
    "content_hash": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$",
      "description": "SHA-256 hash of file content (used as S3 key)"
    },
    "name": {
      "type": "string",
      "description": "Optional: Name for library items (not used for message renders)"
    },
    "format": {
      "type": "string",
      "enum": ["mp3", "wav", "m4a"],
      "description": "Audio file format"
    },
    "bitrate": {
      "type": "integer",
      "description": "Audio bitrate in kbps"
    },
    "duration": {
      "type": "number",
      "description": "Duration in seconds"
    },
    "size_bytes": {
      "type": "integer",
      "description": "File size in bytes"
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO timestamp of creation"
    },
    "reference_count": {
      "type": "integer",
      "description": "Number of references (messages + playlists)",
      "minimum": 0
    },
    "pending_deletion": {
      "type": "boolean",
      "description": "True if S3 deletion failed, needs retry"
    }
  },
  "required": [
    "schema_version",
    "id",
    "url",
    "s3_key",
    "content_hash",
    "format",
    "created_at",
    "reference_count"
  ],
  "additionalProperties": false
}

